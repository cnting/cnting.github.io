---
layout:     post
title:      "ä½¿ç”¨Themeçš„æ­£ç¡®æ–¹å¼"
subtitle:   " è®°å½• èµ„æºæ•´ç† ä»¥åŠ å¤œé—´æ¨¡å¼é€‚é… çš„è¿‡ç¨‹"
date:       2020-12-23 17:24:00
author:     "cnting"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - Android
    - Theme
---



å‰é¢ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯æ‘˜å½•è‡ª[Flywith24 çš„ Android Stylingç³»åˆ—æ–‡ç« ](https://juejin.cn/post/6844903974047318030)ï¼ˆä¸»è¦ä¸ºäº†æ•´ç†å’Œç†è§£æ–¹ä¾¿ğŸ˜‚ï¼‰ï¼Œå¼ºçƒˆå»ºè®®å¤§å®¶çœ‹åŸæ–‡



## ä¸€ã€Theme å’Œ Styleçš„åŒºåˆ«

#### Styleæ˜¯ä»€ä¹ˆï¼Ÿ

Styleæ˜¯**viewçš„å±æ€§çš„é›†åˆ** ï¼Œä½ å¯ä»¥å°†styleè§†ä¸º`Map<view attribute,resource>`ã€‚è¿™é‡Œçš„keyæ˜¯viewçš„æ‰€æœ‰å±æ€§ï¼Œéƒ½æ˜¯å¯ä»¥åœ¨layoutæ–‡ä»¶ä¸­é…ç½®çš„

ä¸€ä¸ªstyleåªèƒ½ä½œç”¨äºå…¶åº”ç”¨çš„viewï¼Œä¸åŒ…å«å®ƒçš„å­viewã€‚ä½¿ç”¨æ—¶ç”¨`style`æ ‡ç­¾

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85e7217bbc0f46c591d574cf85828b70~tplv-k3u1fbpfcp-zoom-1.image" alt="Style ä½œç”¨èŒƒå›´" style="zoom:55%;" />



#### Themeæ˜¯ä»€ä¹ˆï¼Ÿ

Themeæ˜¯èµ„æºçš„é›†åˆï¼Œå®ƒå¯ä»¥è¢«styleã€layoutæˆ–è€…å…¶ä»–å¼•ç”¨ã€‚å®ƒä¸ºandroidèµ„æºæä¾›è¯­ä¹‰æ˜ç¡®çš„å‘½åï¼Œå¦‚ä¸‹ï¼š

```xml
<!-- Copyright 2019 Google LLC.	
   SPDX-License-Identifier: Apache-2.0 -->
<style name="Theme.Plaid" parent="â€¦">
  <item name="colorPrimary">@color/teal_500</item>
  <item name="colorSecondary">@color/pink_200</item>
  <item name="android:windowBackground">@color/white</item>
</style>
```

Themeä¸ºè¿™äº›å·²å‘½åçš„èµ„æºæä¾›æ­£ç¡®çš„å€¼ï¼Œå¹¿æ³›åº”ç”¨åœ¨æ•´ä¸ªç¨‹åºä¸­ã€‚åœ¨å¼•ç”¨ä¸»é¢˜å±æ€§æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`?attr/`è¯­æ³•ï¼Œå…¶ä¸­`?`ä»£è¡¨åœ¨å½“å‰ä¸»é¢˜ä¸­æœç´¢ã€‚

Themeå¯ä»¥åœ¨`application`ã€`Activity`ã€`View`ä¸­è®¾ç½®ï¼Œå¯ä»¥ä½œä¸ºContextçš„å±æ€§è¢«è·å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`ContextThemeWrapper`åŒ…è£…ç°æœ‰çš„Contextæ¥åœ¨ä»£ç ä¸­è®¾ç½®themeï¼Œç„¶åå°†å…¶ç”¨äºinflateå¸ƒå±€ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•çœ‹ç¬¬ä¸‰èŠ‚

å®šä¹‰çš„themeä¼šç”Ÿæˆä¸€ä¸ªæ ‘ï¼Œåœ¨æ­¤æ ‘çš„ä»»ä½•çº§åˆ«ä¸ŠæŒ‡å®šä¸»é¢˜éƒ½ä¼šå½±å“åˆ°åä»£èŠ‚ç‚¹ã€‚ä½¿ç”¨æ—¶ç”¨`theme`æ ‡ç­¾

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6f53dd8ede247e6a027d8601961b966~tplv-k3u1fbpfcp-zoom-1.image" alt="theme ä½œç”¨èŒƒå›´" style="zoom:55%;" />



æ€»ç»“ä¸‹ï¼š

|       | æ¦‚å¿µ           | ä½œç”¨èŒƒå›´                           |
| ----- | -------------- | ---------------------------------- |
| Style | viewçš„å±æ€§é›†åˆ | åªä½œç”¨äºåº”ç”¨çš„viewï¼Œæ²¡æœ‰ç»§æ‰¿å…³ç³»   |
| Theme | èµ„æºçš„é›†åˆ     | ä¼šä½œç”¨äºæ ‘ä¸­æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæœ‰ç»§æ‰¿å…³ç³» |



## äºŒã€å¸¸ç”¨ä¸»é¢˜å±æ€§

ç³»ç»Ÿå®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„ä¸»é¢˜å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿé‰´ä¸‹ï¼Œçœ‹è¿™é‡Œï¼š[Color Theming](https://material.io/develop/android/theming/color)

#### Colors

* `?attr/colorPrimary` app ä¸»è‰²
* `?attr/colorSecondary` app æ¬¡çº§é¢œè‰²ï¼Œé€šå¸¸ä½œä¸ºä¸»è‰²çš„è¡¥å……
* `?attr/colorOn[Primary, Secondary, Surface etc]` ä¸å‘½åé¢œè‰²å½¢æˆå¯¹æ¯”çš„é¢œè‰²ï¼Œå¸¸ç”¨æ¥å®šä¹‰æ–‡å­—é¢œè‰²
* `?attr/color[Primary, Secondary]Variant` ç»™å®šé¢œè‰²çš„é˜´å½±
* `?attr/colorSurface` ç»„ä»¶ç•Œé¢ï¼ˆå¡ç‰‡ï¼Œè¡¨æ ¼ï¼Œèœå•ç­‰ï¼‰çš„é¢œè‰²
* `?android:attr/colorBackground` èƒŒæ™¯
* `?attr/colorPrimarySurface` åœ¨æµ…è‰²ä¸»é¢˜çš„  `colorPrimary` å’Œæ·±è‰²ä¸»é¢˜çš„ `colorSurface` é—´åˆ‡æ¢
* `?attr/colorError` é”™è¯¯æ¶ˆæ¯çš„é¢œè‰²
* `?attr/colorControlNormal` æ­£å¸¸çŠ¶æ€ä¸‹å›¾æ ‡/æ§ä»¶çš„é¢œè‰²
* `?attr/colorControlActivated` æ¿€æ´»çŠ¶æ€ä¸‹å›¾æ ‡/æ§ä»¶çš„é¢œè‰²ï¼ˆä¾‹å¦‚ checkedï¼‰
* `?attr/colorControlHighlight` é«˜äº®é¢œè‰²ï¼ˆä¾‹å¦‚ ripplesï¼Œ list selectorsï¼‰
* `?android:attr/textColorPrimary` text çªå‡ºé¢œè‰²
* `?android:attr/textColorSecondary` text æ¬¡è¦é¢œè‰²

#### Dimens

- `?attr/listPreferredItemHeight` list item çš„æ ‡å‡†ï¼ˆæœ€å°ï¼‰é«˜åº¦
- `?attr/actionBarSize` toolbar çš„é«˜åº¦

#### Drawables

* `?attr/selectableItemBackground` å½“å‰äº¤äº’é¡¹çš„æ°´æ³¢çº¹/é«˜äº®ï¼ˆä¹Ÿä¸ºå‰æ™¯æä¾›äº†ä¾¿åˆ©ï¼‰

* `?attr/selectableItemBackgroundBorderless` æ— ç•Œçš„æ°´æ³¢çº¹

* `?attr/dividerVertical` ä¸€ä¸ªå¯ç»˜åˆ¶å¯¹è±¡ï¼Œå¯ç”¨ä½œå…ƒç´ ä¹‹é—´çš„å‚ç›´åˆ†éš”çº¿

* `?attr/dividerHorizontal` ä¸€ä¸ªå¯ç»˜åˆ¶å¯¹è±¡ï¼Œå¯ç”¨ä½œå…ƒç´ ä¹‹é—´çš„æ°´å¹³åˆ†éš”çº¿

#### TextAppearances

æ”¾åœ¨`type.xml`æ–‡ä»¶ä¸­ï¼Œå®šä¹‰[å¸¸ç”¨å­—ä½“å¤§å°](https://material.io/design/typography/the-type-system.html#type-scale)ï¼Œåœ¨TextViewä¸­å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¼•ç”¨

`````
android:textAppearance="?attr/textAppearanceBody1"
`````

* `?attr/textAppearanceHeadline1`  é»˜è®¤çš„æµ…è‰² 96sp æ–‡æœ¬

* `?attr/textAppearanceHeadline2`  é»˜è®¤çš„æµ…è‰² 60sp æ–‡æœ¬

* `?attr/textAppearanceHeadline3`  é»˜è®¤çš„æ™®é€š 48sp æ–‡æœ¬

* `?attr/textAppearanceHeadline4`  é»˜è®¤çš„æ™®é€š 34sp æ–‡æœ¬

* `?attr/textAppearanceHeadline5`  é»˜è®¤çš„æ™®é€š 24sp æ–‡æœ¬

* `?attr/textAppearanceHeadline6`  é»˜è®¤çš„ä¸­ç­‰ 20sp æ–‡æœ¬

* `?attr/textAppearanceSubtitle1`  é»˜è®¤çš„æ™®é€š 16sp æ–‡æœ¬

* `?attr/textAppearanceSubtitle2`  é»˜è®¤çš„ä¸­ç­‰ 14sp æ–‡æœ¬

* `?attr/textAppearanceBody1`  é»˜è®¤çš„æ™®é€š 16sp æ–‡æœ¬ï¼Œé»˜è®¤å­—æ ·å¼

* `?attr/textAppearanceBody2`  é»˜è®¤çš„æ™®é€š 14sp æ–‡æœ¬

* `?attr/textAppearanceCaption`  é»˜è®¤æ™®é€š 12sp æ–‡æœ¬

* `?attr/textAppearanceButton`  é»˜è®¤çš„ä¸­ç­‰å…¨å¤§å†™ 14sp æ–‡æœ¬

* `?attr/textAppearanceOverline`  é»˜è®¤çš„ä¸­ç­‰å…¨å¤§å†™ 10sp æ–‡æœ¬

#### Shape

æ”¾åœ¨`shape.xml`æ–‡ä»¶ä¸­ï¼Œå®šä¹‰ä¸€äº›å¸¸ç”¨å½¢çŠ¶çš„åœ†è§’ç­‰å±æ€§ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å¯ä»¥çœ‹è¿™é‡Œï¼š[Shape Theming](https://material.io/develop/android/theming/shape)ã€‚è¦åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸Šè®¾ç½®shapeï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨`MaterialShapeDrawable`ï¼Œå®ƒå¯ä»¥ç†è§£å¹¶å®ç°shape

* `?attr/shapeAppearanceSmallComponent` åœ¨ Button ï¼ŒChipï¼ŒText çš„å±æ€§ä¸­ä½¿ç”¨ï¼Œé»˜è®¤ 4dp çš„åœ†è§’

* `?attr/shapeAppearanceMediumComponent` åœ¨ Cardï¼ŒDialogï¼ŒDate Picker ä¸­ä½¿ç”¨ï¼Œé»˜è®¤ 4dp çš„åœ†è§’

* `?attr/shapeAppearanceLargeComponent` åœ¨ Bottom Sheet ä¸­ä½¿ç”¨ï¼Œé»˜è®¤ 0dp åœ†è§’

#### Button Styles

<img src="https://lh3.googleusercontent.com/paigCrPwj4o5nOy781U_k0QfrtmDz9dcQEdBzUUqitMEfzXhy4XWKwQPEFiM0qbpZidJxv3VE3FlFK-GkcHVLRXm8ew0GBn9HjRw8Ec=w1064-v0" alt="&quot;Button types - text, outlined, contained and toggle.&quot;" style="zoom:50%;" />

Material å®šä¹‰äº†å››ç§ç±»å‹çš„Buttonï¼šTextã€Outlinedã€Containedã€Toggleï¼Œå¯ç”¨äºè®¾ç½®`MaterialButton`çš„ styleï¼Œå…·ä½“ä½¿ç”¨çœ‹è¿™é‡Œï¼š[Buttons](https://material.io/components/buttons/android)

* `?attr/materialButtonStyle` é»˜è®¤æ ·å¼ï¼Œå¯çœç•¥

* `?attr/borderlessButtonStyle` æ–‡æœ¬æ ·å¼çš„ button

* `?attr/materialButtonOutlinedStyle` outline æ ·å¼çš„ button

* `?attr/materialButtonToggleGroupStyle` Toggleæ ·å¼çš„buttonã€‚Toggleç±»å‹æŒ‰é’®ä½¿ç”¨`MaterialButtonToggleGroup`ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

  ```xml
  <com.google.android.material.button.MaterialButtonToggleGroup
      android:id="@+id/toggleButton"
      android:layout_width="wrap_content"
      android:layout_height="wrap_content">
      <Button
          android:id="@+id/button1"
          android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="Button 1"
          style="?attr/materialButtonOutlinedStyle"
      />
      <Button
          android:id="@+id/button2"
          android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="Button 2"
          style="?attr/materialButtonOutlinedStyle"
      />
      <Button
          android:id="@+id/button3"
          android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="Button 3"
          style="?attr/materialButtonOutlinedStyle"
      />
  </com.google.android.material.button.MaterialButtonToggleGroup>
  ```

#### App vs Android namespace

ä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œæœ‰äº›å±æ€§valueç”± `?android:attr/foo` å¼•ç”¨ï¼Œè€Œå…¶ä»–çš„åˆ™ä¸º `?attr/bar` ã€‚è¿™æ˜¯å› ä¸ºå®ƒä»¬ä¸­çš„éƒ¨åˆ†æ˜¯ç”± Android Platform å®šä¹‰çš„ï¼Œå› æ­¤æ‚¨éœ€è¦ `android`å‰ç¼€é€šè¿‡å‘½åç©ºé—´å¼•ç”¨å®ƒä»¬ï¼ˆå°±åƒ layout ä¸­ view çš„å±æ€§ï¼š`android:id`ï¼‰ã€‚é‚£äº›ä¸æ˜¯æ¥è‡ªé™æ€åº“ï¼ˆå³ AppCompat æˆ– MDC ï¼‰ï¼Œå®ƒä»¬å·²ç¼–è¯‘åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå› æ­¤ä¸éœ€è¦åç§°ç©ºé—´ï¼ˆç±»ä¼¼äºæ‚¨åœ¨å¸ƒå±€ä¸­ä½¿ç”¨ `appï¼šbaz` çš„æ–¹å¼ï¼‰ã€‚ä¸€äº›å…ƒç´ åœ¨ platform å’Œ library å‡æœ‰å®šä¹‰ï¼ˆä¾‹å¦‚ `colorPrimary`ï¼‰ã€‚**åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½ä½¿ç”¨éå¹³å°ç‰ˆæœ¬`?attr/bar`ï¼Œè¿™æ ·å¯ä»¥åœ¨æ‰€æœ‰ API çº§åˆ«ä¸Šä½¿ç”¨**ã€‚ä¾‹å¦‚å®ƒä»¬æ˜¯åœ¨ library ä¸­é‡å¤å®šä¹‰æ°å¥½ç›®çš„æ˜¯ä¸ºäº†å‘åå…¼å®¹

åŒæ—¶ï¼Œç”±äºéƒ¨åˆ†å±æ€§keyçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼Œä¸ºäº†é¿å…æ·»åŠ å¤šä¸ªç‰ˆæœ¬çš„stylesæ–‡ä»¶ï¼Œå¯ä»¥çœç•¥`android:`å‘½åç©ºé—´

å¯ç”¨å±æ€§çš„å®Œæ•´åˆ—è¡¨ï¼š

* [Android platform](https://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/core/res/res/values/attrs.xml)
* [AppCompat](https://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/appcompat/appcompat/src/main/res/values/attrs.xml)
* [Material Color](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/color/res/values/attrs.xml)
* [Material Shape](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/shape/res/values/attrs.xml)
* [Material Type](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/typography/res/values/attrs.xml)





## ä¸‰ã€ThemeOverlay

Themeä¸»è¦åˆ†ä¸¤ç§ï¼š

* ç»™æ•´ä¸ªé¡µé¢è®¾ç½®çš„themeï¼Œä¸€èˆ¬è®¾ç½®åœ¨Activityä¸Šï¼Œç³»ç»Ÿå®šä¹‰çš„è¿™ç±»themeä¸€èˆ¬å‘½åçš„å‰ç¼€æ˜¯AppCompatï¼Œä¾‹å¦‚`Theme.AppCompat.DayNight.DarkActionBar`
* ç»™ **view** è®¾ç½®çš„themeï¼ŒåŒºåˆ«äºæ•´ä¸ªé¡µé¢çš„themeï¼Œè¿™æ—¶å€™åº”è¯¥ä½¿ç”¨ThemeOverlayã€‚ç³»ç»Ÿå®šä¹‰çš„è¿™ç±»themeä¸€èˆ¬å‘½åå‰ç¼€æ˜¯ThemeOverlayï¼Œä¾‹å¦‚`ThemeOverlay.MaterialComponents.Toolbar.Surface`

ThemeOverlayåªå®šä¹‰æƒ³è¦æ”¹å˜çš„å±æ€§ï¼Œå…¶ä»–å±æ€§ä¸ä¼šè¢«æ”¹å˜ï¼Œ**æ³¨æ„parentç»å¸¸ä¼šè®¾ç½®ä¸º""**ã€‚çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œåªæœ‰`colorControlNormal`å’ŒactionMenuTextColorå±æ€§æ”¹å˜

![image-20201224104052296](https://gitee.com/cnting/cnting-blog-img/raw/master/img/image-20201224104052296.png)

ç³»ç»Ÿå®šä¹‰äº†å¾ˆå¤šå¸¸ç”¨çš„ThemeOverlayï¼Œå¯ä»¥çœ‹çœ‹[MDC](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/theme/res/values/themes_overlay.xml) å’Œ [AppCompat](https://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/appcompat/appcompat/src/main/res/values/themes.xml#76)

è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œ**å½“åœ¨viewä¸­ä½¿ç”¨Themeæ—¶ï¼Œåº”è¯¥ä½¿ç”¨ThemeOverlay**

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b430a9dde81f4372921e81ed2f9db63a~tplv-k3u1fbpfcp-zoom-1.image)

#### å†…å­˜å¼€é”€

æ¯å£°æ˜ä¸€ä¸ª`android:theme`,éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„`ContextThemeWrapper`æ¥åˆ†é…æ–°çš„Themeå’ŒResourceå®ä¾‹ï¼Œè¿˜é—´æ¥å¼•å…¥æ›´å¤šå±‚çš„stylingï¼Œæ‰€ä»¥è¦è°¨æ…ä½¿ç”¨themeï¼Œå°¤å…¶åœ¨RecyclerViewä¸‹



#### ä½¿ç”¨æ­£ç¡®çš„Context

Themeå¯ä»¥ä½œä¸ºContextçš„å±æ€§è¢«è·å–ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ä»ä»»ä½•Contextæˆ–è€…Contextçš„å­ç±»è·å¾—ï¼Œä¾‹å¦‚Activityã€Viewã€ViewGroupã€‚è¿™äº›å¯¹è±¡å­˜åœ¨äºä¸€ä¸ªæ ‘ä¸­ï¼Œåœ¨æ­¤æ ‘çš„ä»»ä½•çº§åˆ«ä¸ŠæŒ‡å®šä¸»é¢˜éƒ½ä¼šå½±å“åˆ°åä»£èŠ‚ç‚¹ã€‚

æŸ¥æ‰¾themeæ˜¯è·Ÿå½“å‰Contextç›¸å…³çš„ï¼Œæ‰€ä»¥è¦ä½¿ç”¨è·Ÿå½“å‰å±‚çº§æœ€æ¥è¿‘çš„Contextï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œ`Theme.App.Foo`å’Œ`Theme.App.Bar`ä¸­éƒ½å®šä¹‰äº†`foo`å±æ€§

```xml
<ViewGroup â€¦
  android:theme="@style/Theme.App.Foo">
  <Button â€¦
    android:theme="@style/Theme.App.Bar"/>
</ViewGroup>
```

å¦‚æœæˆ‘æƒ³åœ¨ä»£ç ä¸­æŸ¥æ‰¾`Button `çš„`foo`çš„å€¼ï¼Œéœ€è¦ä½¿ç”¨`button.getContext()`

```java
button.background = AppCompatResources.getDrawable(button.context,R.drawable.foo)
```

ä¸Šé¢è¯´åˆ°Themeå¯ä»¥ä½œä¸ºContextçš„å±æ€§è¢«è·å–ï¼Œä½†è¿™ä¸ªContextä¸åŒ…å«Applicationã€‚Application Contextä¸åŒ…å«ä»»ä½•ä¸»é¢˜ä¿¡æ¯ï¼Œåœ¨manifestä¸­`<application>`æ ‡ç­¾ä¸­è®¾ç½®çš„ä¸»é¢˜ä»…ä½œç”¨äºé‚£äº›æ²¡æŒ‡å®šä¸»é¢˜çš„Activityã€‚å› æ­¤ä¸è¦ä½¿ç”¨Application ContextåŠ è½½themeä¸­çš„èµ„æºã€‚

è¿™ä¹Ÿè¯´æ˜äº†åœ¨Activityå®šä¹‰çš„themeä¸ä¼šå—Applicationä¸­çš„Themeå½±å“



#### åœ¨ä»£ç ä¸­ä½¿ç”¨Theme Overlay

å¦‚æœæƒ³è¦åœ¨ä»£ç ä¸­ä½¿ç”¨Theme Overlayï¼Œå¯ä»¥å°†å…¶åŒ…è£¹æˆ`ContextThemeWrapper`ï¼Œè¿™ä¹Ÿæ˜¯`android:theme`æ ‡ç­¾å†…éƒ¨åšçš„äº‹æƒ…

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95f6cda77a05443eae87ba7e2b93f3e3~tplv-k3u1fbpfcp-zoom-1.image" alt="img" style="zoom:67%;" />



## ä¸€äº›å°æŠ€å·§

#### 1. è®¾ç½®é€æ˜åº¦

ä½¿ç”¨`ColorStateList`(ä¹Ÿå°±æ˜¯å¸¸è¯´çš„Selector)ï¼Œåªé…ç½®ä¸€ä¸ªitemï¼Œå¹¶è®¾ç½®é€æ˜åº¦

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c626bcd9fedf4ee9ae4b8aa09bc732f9~tplv-k3u1fbpfcp-zoom-1.image" alt="img" style="zoom:87%;" />



#### 2. ColorStateList å’Œ Drawableè½¬æ¢

ç»™viewè®¾ç½®backgroundç­‰å±æ€§æ—¶å¯ä»¥ç›´æ¥ä¼ å…¥colorï¼Œåœ¨å†…éƒ¨ç³»ç»Ÿä¼šå°†å®ƒåŒ…è£…æˆ`ColorDrawable`ã€‚ä½†å¦‚æœå°†`ColorStateList`ä¼ å…¥å°±ä¸è¡Œï¼Œåœ¨API 28ä¹‹å‰ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸º`ColorDrawable`æ˜¯æ— çŠ¶æ€çš„ï¼Œåœ¨Android 10ä¸­ï¼Œå®˜æ–¹åŠ å…¥äº†`ColorStateListDrawable`è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¸ºäº†æ‰€æœ‰APIéƒ½èƒ½ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`backgroundTint`æ–¹å¼è§£å†³

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8eb34265ef6438c847a147e6350dc8a~tplv-k3u1fbpfcp-zoom-1.image" alt="img" style="zoom:80%;" />



#### 3. æ‹†åˆ†å¤šä¸ªæ–‡ä»¶

* `theme.xml` : Theme å’Œ Theme Overlay
* `type.xml`ï¼š å­—ä½“ã€æ–‡æœ¬å¤–è§‚ã€æ–‡æœ¬å°ºå¯¸ã€å­—ä½“æ–‡ä»¶ç­‰
* `style.xml`ï¼šåªæœ‰widget style
* `shape.xml`ï¼šå½¢çŠ¶ç›¸å…³çš„style
* `dimens.xml`ã€`colors.xml`ã€`strings.xml`



#### 4. å‘½åè§„èŒƒ

```
[Style Type].[Group Name].[Sub-group Name].[Variant Name]
```

###### 1. Style Type

æè¿°è¿™ä¸ªstyleç±»å‹ï¼Œå¯ä»¥æ˜¯themeã€æ ·å¼ã€æ–‡æœ¬å¤–è§‚ã€Theme Overlayç­‰

| ç±»å‹          | å¸¸ç”¨åå­—        | ä¸¾ä¾‹                                                  |
| ------------- | --------------- | ----------------------------------------------------- |
| theme         | Theme           | **Theme**.AppCompat.DayNight.DarkActionBar            |
| Theme Overlay | ThemeOverlay    | **ThemeOverlay**.MaterialComponents.Toolbar.Surface   |
| æ§ä»¶ style    | Widget          | **Widget**.AppCompat.Toolbar                          |
| æ–‡æœ¬æ ·å¼      | TextAppearance  | **TextAppearance**.AppCompat.Body1                    |
| å½¢çŠ¶          | ShapeAppearance | **ShapeAppearance**.MaterialComponents.LargeComponent |
| åŠ¨ç”»          | Animation       | **Animation**.Design.BottomSheetDialog                |

###### 2. Group Name

é€šå¸¸é‡‡ç”¨åº”ç”¨åç§°ï¼Œå¦‚æœæ˜¯å¤šmoduleä¹Ÿå¯ä»¥ç”¨moduleå

###### 3. Sub-group name

é€šå¸¸ç”¨äºwidgetï¼Œä¾‹å¦‚ï¼šWidget.Design.**TabLayout**

###### 4. Variant Name

è¿™æ˜¯å¯é€‰çš„ï¼Œè¿™æ˜¯ä¸»é¢˜çš„å˜é‡ï¼Œä¾‹å¦‚ï¼š

* ThemeOverlay.MaterialComponents.Toolbar.**Primary**
* ThemeOverlay.MaterialComponents.Toolbar.**Surface**



###### 5. ColorPrimaryçš„ä½¿ç”¨

æœ‰äº›æ—¶å€™ï¼Œå¸Œæœ›æŸä¸ªé¢œè‰²æ—¥é—´æ¨¡å¼ä½¿ç”¨colorPrimaryï¼Œå¤œé—´æ¨¡å¼ä½¿ç”¨colorSurfaceï¼Œå¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„`?attr/colorPrimarySurface`



## å®ä¾‹1

ä¸€ç›´ä»¥æ¥ï¼Œä½¿ç”¨colorã€themeéƒ½æ˜¯æŒ‰ç…§ä¸‹é¢æ–¹å¼

åœ¨`res/values/colors.xml` å’Œ `res/values-night/colors.xml` ä¸­å®šä¹‰`color_primary`ï¼Œç„¶ååœ¨layoutä¸­ä½¿ç”¨`@color/color_primary`ã€‚

è¿™æ ·æœ‰å‡ ä¸ªä¸å¥½çš„ç‚¹ï¼š

1. coloré‡Œçš„å‘½åæ—¢ä»£è¡¨äº†è¯­ä¹‰åˆä»£è¡¨äº†è‰²å€¼ï¼Œä¼šå¯¼è‡´ä¸€äº›è‰²å€¼é‡å¤å®šä¹‰
2. æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰çš„é¢œè‰²ä¸æƒ³è·Ÿç€æ—¥å¤œé—´æ¨¡å¼åˆ‡æ¢è€Œæ”¹å˜ï¼Œå°±éœ€è¦å†é‡å¤å®šä¹‰ä¸€äº›ç›¸åŒçš„é¢œè‰²äº†



æ­£ç¡®åšæ³•åº”è¯¥æ˜¯è¿™æ ·ï¼š

1. åœ¨colorä¸­ç”¨é¢œè‰²å€¼å‘½å

   ```xml
   //values/colors.xml
   <color name="indigo_500">...</color>
   <color name="indigo_200">...</color>
   ```

   

2. åœ¨themeæŠ½å–å…¬å…±éƒ¨åˆ†åˆ°`Base.Theme.MyApp`ï¼Œç„¶åå†æ ¹æ®æ—¥å¤œé—´æ¨¡å¼å®šä¹‰ä¸¤ä¸ªthemeä¸­å®šä¹‰

   ```xml
   //values/themes.xml
   <style name="Theme.MyApp" parent="Base.Theme.MyApp">
     <item name="colorPrimary">@color/indigo_500</item>
   </style>
   
   //values-night/themes.xml
   <style name="Theme.MyApp" parent="Base.Theme.MyApp">
     <item name="colorPrimary">@color/indigo_200</item>
   </style>
   ```

   

3. åœ¨layoutä¸­å¼•ç”¨`android:background="?attr/colorPrimary"`





## å¸¸è§é—®é¢˜

#### 1. ActionBarå’ŒToolBaråŒºåˆ«

ActionBaræ˜¯3.0æ¨å‡ºçš„ï¼ŒToolBaræ˜¯5.0æ¨å‡ºçš„ï¼Œç›®çš„æ˜¯ä¸ºäº†å–ä»£ActionBarã€‚å–ä»£æ–¹å¼å¦‚ä¸‹ï¼š

1. åœ¨ä¸»é¢˜themeé‡Œç»§æ‰¿åç¼€ä¸º`.NoActionBar` çš„ä¸»é¢˜

2. åœ¨ä»£ç ä¸­è®¾ç½® `setSupportActionBar(toobar)`

   

#### 2.ä½ç‰ˆæœ¬ä½¿ç”¨alpha

alphaç»„ä»¶æ˜¯åœ¨API23åå¼•å…¥ï¼Œæ‰€ä»¥å¦‚æœmin sdkæ¯”è¿™ä¸ªä½ï¼Œè¦ä½¿ç”¨å…¼å®¹çš„[AppCompatResources.getColorStateList](https://developer.android.com/reference/androidx/appcompat/content/res/AppCompatResources.html#public-methods_1) å¹¶ä¸€ç›´ä½¿ç”¨ `android:alpha` å‘½åç©ºé—´ï¼Œä¸è¦ä½¿ç”¨ `app:alpha` å‘½åç©ºé—´

#### 3. æ£€æµ‹å·¥å…·

[Making Android Lint Theme Aware â€” Part 1](https://proandroiddev.com/making-android-lint-theme-aware-6285737b13bc)

