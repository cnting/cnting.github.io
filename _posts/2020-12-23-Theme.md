---
layout:     post
title:      "ä½¿ç”¨Themeçš„æ­£ç¡®æ–¹å¼"
subtitle:   " è®°å½• èµ„æºæ•´ç† ä»¥åŠ æ·±è‰²æ¨¡å¼é€‚é… çš„è¿‡ç¨‹"
date:       2020-12-23 17:24:00
author:     "cnting"
header-img: "img/post-bg-universe.jpg"
catalog: true
tags:
    - Android
    - Theme
---



å‰é¢ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯æ‘˜å½•è‡ª[Flywith24 çš„ Android Stylingç³»åˆ—æ–‡ç« ](https://juejin.cn/post/6844903974047318030)ï¼ˆä¸»è¦ä¸ºäº†æ•´ç†å’Œç†è§£æ–¹ä¾¿ğŸ˜‚ï¼‰ï¼Œå¼ºçƒˆå»ºè®®å¤§å®¶çœ‹å¤§ä½¬çš„åŸæ–‡



## ä¸€ã€Theme å’Œ Styleçš„åŒºåˆ«

#### Styleæ˜¯ä»€ä¹ˆï¼Ÿ

Styleæ˜¯**viewçš„å±æ€§çš„é›†åˆ** ï¼Œä½ å¯ä»¥å°†styleè§†ä¸º`Map<view attribute,resource>`ã€‚è¿™é‡Œçš„keyæ˜¯viewçš„æ‰€æœ‰å±æ€§ï¼Œéƒ½æ˜¯å¯ä»¥åœ¨layoutæ–‡ä»¶ä¸­é…ç½®çš„

ä¸€ä¸ªstyleåªèƒ½ä½œç”¨äºå…¶åº”ç”¨çš„viewï¼Œä¸åŒ…å«å®ƒçš„å­viewã€‚ä½¿ç”¨æ—¶ç”¨`style`æ ‡ç­¾

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85e7217bbc0f46c591d574cf85828b70~tplv-k3u1fbpfcp-zoom-1.image" alt="Style ä½œç”¨èŒƒå›´" style="zoom:55%;" />



#### Themeæ˜¯ä»€ä¹ˆï¼Ÿ

Themeæ˜¯èµ„æºçš„é›†åˆï¼Œå®ƒå¯ä»¥è¢«styleã€layoutæˆ–è€…å…¶ä»–å¼•ç”¨ã€‚å®ƒä¸ºandroidèµ„æºæä¾›è¯­ä¹‰æ˜ç¡®çš„å‘½åï¼Œå¦‚ä¸‹ï¼š

```xml
<style name="Theme.Plaid" parent="â€¦">
  <item name="colorPrimary">@color/teal_500</item>
  <item name="colorSecondary">@color/pink_200</item>
  <item name="android:windowBackground">@color/white</item>
</style>
```

Themeä¸ºè¿™äº›å·²å‘½åçš„èµ„æºæä¾›æ­£ç¡®çš„å€¼ï¼Œåº”ç”¨åœ¨æ•´ä¸ªappä¸­ã€‚åœ¨å¼•ç”¨ä¸»é¢˜å±æ€§æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`?attr/`è¯­æ³•ï¼Œå…¶ä¸­`?`ä»£è¡¨åœ¨å½“å‰ä¸»é¢˜ä¸­æœç´¢ã€‚

Themeå¯ä»¥åœ¨`application`ã€`Activity`ã€`View`ä¸­è®¾ç½®ï¼Œå¯ä»¥ä½œä¸ºContextçš„å±æ€§è¢«è·å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`ContextThemeWrapper`åŒ…è£…ç°æœ‰çš„Contextæ¥åœ¨ä»£ç ä¸­è®¾ç½®themeï¼Œç„¶åå°†å…¶ç”¨äºinflateå¸ƒå±€ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•çœ‹ç¬¬ä¸‰èŠ‚

å®šä¹‰çš„themeä¼šç”Ÿæˆä¸€ä¸ªæ ‘ï¼Œåœ¨æ­¤æ ‘çš„ä»»ä½•çº§åˆ«ä¸ŠæŒ‡å®šä¸»é¢˜éƒ½ä¼šå½±å“åˆ°åä»£èŠ‚ç‚¹ã€‚ä½¿ç”¨æ—¶ç”¨`theme`æ ‡ç­¾

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6f53dd8ede247e6a027d8601961b966~tplv-k3u1fbpfcp-zoom-1.image" alt="theme ä½œç”¨èŒƒå›´" style="zoom:55%;" />



æ€»ç»“ä¸‹ï¼š

|       | æ¦‚å¿µ           | ä½œç”¨èŒƒå›´                           |
| ----- | -------------- | ---------------------------------- |
| Style | viewçš„å±æ€§é›†åˆ | åªä½œç”¨äºåº”ç”¨çš„viewï¼Œæ²¡æœ‰ç»§æ‰¿å…³ç³»   |
| Theme | èµ„æºçš„é›†åˆ     | ä¼šä½œç”¨äºæ ‘ä¸­æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæœ‰ç»§æ‰¿å…³ç³» |



## äºŒã€å¸¸ç”¨ä¸»é¢˜å±æ€§

ä¸Šé¢è¯´åˆ°ï¼Œ`?attr/`è¡¨ç¤ºåœ¨å½“å‰ä¸»é¢˜ä¸­æœç´¢èµ„æºï¼Œ`?attr/`åé¢çš„å†…å®¹éœ€è¦åœ¨`attr.xml`æ–‡ä»¶ä¸­å®šä¹‰ã€‚ç³»ç»Ÿå·²ç»å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„ä¸»é¢˜å±æ€§åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ï¼Œçœ‹è¿™é‡Œï¼š[Color Theming](https://material.io/develop/android/theming/color)

#### Colors

* `?attr/colorPrimary` app ä¸»è‰²
* `?attr/colorSecondary` app æ¬¡çº§é¢œè‰²ï¼Œé€šå¸¸ä½œä¸ºä¸»è‰²çš„è¡¥å……
* `?attr/colorOn[Primary, Secondary, Surface etc]` ä¸å‘½åé¢œè‰²å½¢æˆå¯¹æ¯”çš„é¢œè‰²ï¼Œå¸¸ç”¨æ¥å®šä¹‰æ–‡å­—é¢œè‰²
* `?attr/color[Primary, Secondary]Variant` ç»™å®šé¢œè‰²çš„é˜´å½±
* `?attr/colorSurface` ç»„ä»¶ç•Œé¢ï¼ˆå¡ç‰‡ï¼Œè¡¨æ ¼ï¼Œèœå•ç­‰ï¼‰çš„é¢œè‰²
* `?android:attr/colorBackground` èƒŒæ™¯
* `?attr/colorPrimarySurface` åœ¨æµ…è‰²ä¸»é¢˜çš„  `colorPrimary` å’Œæ·±è‰²ä¸»é¢˜çš„ `colorSurface` é—´åˆ‡æ¢
* `?attr/colorError` é”™è¯¯æ¶ˆæ¯çš„é¢œè‰²
* `?attr/colorControlNormal` æ­£å¸¸çŠ¶æ€ä¸‹å›¾æ ‡/æ§ä»¶çš„é¢œè‰²
* `?attr/colorControlActivated` æ¿€æ´»çŠ¶æ€ä¸‹å›¾æ ‡/æ§ä»¶çš„é¢œè‰²ï¼ˆä¾‹å¦‚ checkedï¼‰
* `?attr/colorControlHighlight` é«˜äº®é¢œè‰²ï¼ˆä¾‹å¦‚ ripplesï¼Œ list selectorsï¼‰
* `?android:attr/textColorPrimary` text çªå‡ºé¢œè‰²
* `?android:attr/textColorSecondary` text æ¬¡è¦é¢œè‰²

#### Dimens

- `?attr/listPreferredItemHeight` list item çš„æ ‡å‡†ï¼ˆæœ€å°ï¼‰é«˜åº¦
- `?attr/actionBarSize` toolbar çš„é«˜åº¦

#### Drawables

* `?attr/selectableItemBackground` å½“å‰äº¤äº’é¡¹çš„æ°´æ³¢çº¹/é«˜äº®ï¼ˆä¹Ÿä¸ºå‰æ™¯æä¾›äº†ä¾¿åˆ©ï¼‰

* `?attr/selectableItemBackgroundBorderless` æ— ç•Œçš„æ°´æ³¢çº¹

* `?attr/dividerVertical` ä¸€ä¸ªå¯ç»˜åˆ¶å¯¹è±¡ï¼Œå¯ç”¨ä½œå…ƒç´ ä¹‹é—´çš„å‚ç›´åˆ†éš”çº¿

* `?attr/dividerHorizontal` ä¸€ä¸ªå¯ç»˜åˆ¶å¯¹è±¡ï¼Œå¯ç”¨ä½œå…ƒç´ ä¹‹é—´çš„æ°´å¹³åˆ†éš”çº¿

#### TextAppearances

æ”¾åœ¨`type.xml`æ–‡ä»¶ä¸­ï¼Œå®šä¹‰[å¸¸ç”¨å­—ä½“å¤§å°](https://material.io/design/typography/the-type-system.html#type-scale)ï¼Œåœ¨TextViewä¸­å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¼•ç”¨

`````
android:textAppearance="?attr/textAppearanceBody1"
`````

* `?attr/textAppearanceHeadline1`  é»˜è®¤çš„æµ…è‰² 96sp æ–‡æœ¬

* `?attr/textAppearanceHeadline2`  é»˜è®¤çš„æµ…è‰² 60sp æ–‡æœ¬

* `?attr/textAppearanceHeadline3`  é»˜è®¤çš„æ™®é€š 48sp æ–‡æœ¬

* `?attr/textAppearanceHeadline4`  é»˜è®¤çš„æ™®é€š 34sp æ–‡æœ¬

* `?attr/textAppearanceHeadline5`  é»˜è®¤çš„æ™®é€š 24sp æ–‡æœ¬

* `?attr/textAppearanceHeadline6`  é»˜è®¤çš„ä¸­ç­‰ 20sp æ–‡æœ¬

* `?attr/textAppearanceSubtitle1`  é»˜è®¤çš„æ™®é€š 16sp æ–‡æœ¬

* `?attr/textAppearanceSubtitle2`  é»˜è®¤çš„ä¸­ç­‰ 14sp æ–‡æœ¬

* `?attr/textAppearanceBody1`  é»˜è®¤çš„æ™®é€š 16sp æ–‡æœ¬ï¼Œé»˜è®¤å­—æ ·å¼

* `?attr/textAppearanceBody2`  é»˜è®¤çš„æ™®é€š 14sp æ–‡æœ¬

* `?attr/textAppearanceCaption`  é»˜è®¤æ™®é€š 12sp æ–‡æœ¬

* `?attr/textAppearanceButton`  é»˜è®¤çš„ä¸­ç­‰å…¨å¤§å†™ 14sp æ–‡æœ¬

* `?attr/textAppearanceOverline`  é»˜è®¤çš„ä¸­ç­‰å…¨å¤§å†™ 10sp æ–‡æœ¬

#### Shape

æ”¾åœ¨`shape.xml`æ–‡ä»¶ä¸­ï¼Œå®šä¹‰ä¸€äº›å¸¸ç”¨å½¢çŠ¶çš„åœ†è§’ç­‰å±æ€§ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å¯ä»¥çœ‹è¿™é‡Œï¼š[Shape Theming](https://material.io/develop/android/theming/shape)ã€‚è¦åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸Šè®¾ç½®shapeï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨`MaterialShapeDrawable`ï¼Œå®ƒå¯ä»¥ç†è§£å¹¶å®ç°shape

* `?attr/shapeAppearanceSmallComponent` åœ¨ Button ï¼ŒChipï¼ŒText çš„å±æ€§ä¸­ä½¿ç”¨ï¼Œé»˜è®¤ 4dp çš„åœ†è§’

* `?attr/shapeAppearanceMediumComponent` åœ¨ Cardï¼ŒDialogï¼ŒDate Picker ä¸­ä½¿ç”¨ï¼Œé»˜è®¤ 4dp çš„åœ†è§’

* `?attr/shapeAppearanceLargeComponent` åœ¨ Bottom Sheet ä¸­ä½¿ç”¨ï¼Œé»˜è®¤ 0dp åœ†è§’

#### Button Styles

<img src="https://lh3.googleusercontent.com/paigCrPwj4o5nOy781U_k0QfrtmDz9dcQEdBzUUqitMEfzXhy4XWKwQPEFiM0qbpZidJxv3VE3FlFK-GkcHVLRXm8ew0GBn9HjRw8Ec=w1064-v0" alt="&quot;Button types - text, outlined, contained and toggle.&quot;" style="zoom:50%;" />

Material å®šä¹‰äº†å››ç§ç±»å‹çš„Buttonï¼šTextã€Outlinedã€Containedã€Toggleï¼Œå¯ç”¨äºè®¾ç½®`MaterialButton`çš„ styleï¼Œå…·ä½“ä½¿ç”¨çœ‹è¿™é‡Œï¼š[Buttons](https://material.io/components/buttons/android)

* `?attr/materialButtonStyle` é»˜è®¤æ ·å¼ï¼Œå¯çœç•¥

* `?attr/borderlessButtonStyle` æ–‡æœ¬æ ·å¼çš„ button

* `?attr/materialButtonOutlinedStyle` outline æ ·å¼çš„ button

* `?attr/materialButtonToggleGroupStyle` Toggleæ ·å¼çš„buttonã€‚Toggleç±»å‹æŒ‰é’®ä½¿ç”¨`MaterialButtonToggleGroup`ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

  ```xml
  <com.google.android.material.button.MaterialButtonToggleGroup
      android:id="@+id/toggleButton"
      android:layout_width="wrap_content"
      android:layout_height="wrap_content">
      <Button
          android:id="@+id/button1"
          android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="Button 1"
          style="?attr/materialButtonOutlinedStyle"
      />
      <Button
          android:id="@+id/button2"
          android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="Button 2"
          style="?attr/materialButtonOutlinedStyle"
      />
      <Button
          android:id="@+id/button3"
          android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="Button 3"
          style="?attr/materialButtonOutlinedStyle"
      />
  </com.google.android.material.button.MaterialButtonToggleGroup>
  ```

#### App vs Android namespace

ï¼ˆ1ï¼‰å±æ€§valueå€¼

æœ‰äº›valueå€¼æ˜¯`?attr/`ï¼Œæœ‰äº›æ˜¯`?android:attr/`ã€‚ä¸¤è€…åŒºåˆ«æ˜¯ï¼š

* `?attr/`æ˜¯æ¥è‡ª`AppCompat` æˆ–`MDC`ä¸­çš„ï¼Œå¯ä»¥å‘åå…¼å®¹
* `?android:attr/`æ˜¯åœ¨Androidæºç ä¸­å®šä¹‰çš„ï¼Œæ²¡æ³•å‘åå…¼å®¹

**æ‰€ä»¥æœ‰äº›èµ„æºåœ¨`?attr`å’Œ`?android:attr/`ä¸­éƒ½æœ‰å®šä¹‰æ—¶ï¼Œæœ€å¥½ä½¿ç”¨`?attr/`**

ï¼ˆ2ï¼‰å±æ€§keyå€¼

ç”±äºéƒ¨åˆ†å±æ€§keyçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼Œä¸ºäº†é¿å…æ·»åŠ å¤šä¸ªç‰ˆæœ¬çš„stylesæ–‡ä»¶ï¼Œå¯ä»¥çœç•¥`android:`å‘½åç©ºé—´



#### ç³»ç»Ÿå®šä¹‰çš„å¯ç”¨å±æ€§çš„å®Œæ•´åˆ—è¡¨

å·²ç»å®šä¹‰çš„å¯ç”¨å±æ€§åçš„å®Œæ•´åˆ—è¡¨å¦‚ä¸‹ï¼š

* [Android platform](https://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/core/res/res/values/attrs.xml)
* [AppCompat](https://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/appcompat/appcompat/src/main/res/values/attrs.xml)
* [Material Color](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/color/res/values/attrs.xml)
* [Material Shape](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/shape/res/values/attrs.xml)
* [Material Type](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/typography/res/values/attrs.xml)





## ä¸‰ã€ThemeOverlay

Themeä¸»è¦åˆ†ä¸¤ç§ï¼š

* ç»™æ•´ä¸ªé¡µé¢è®¾ç½®çš„themeï¼Œä¸€èˆ¬è®¾ç½®åœ¨Activityä¸Šï¼Œç³»ç»Ÿå®šä¹‰çš„è¿™ç±»themeä¸€èˆ¬å‘½åçš„å‰ç¼€æ˜¯AppCompatï¼Œä¾‹å¦‚`Theme.AppCompat.DayNight.DarkActionBar`
* ç»™ **view** è®¾ç½®çš„themeï¼ŒåŒºåˆ«äºæ•´ä¸ªé¡µé¢çš„themeï¼Œè¿™æ—¶å€™åº”è¯¥ä½¿ç”¨ThemeOverlayã€‚ç³»ç»Ÿå®šä¹‰çš„è¿™ç±»themeä¸€èˆ¬å‘½åå‰ç¼€æ˜¯ThemeOverlayï¼Œä¾‹å¦‚`ThemeOverlay.MaterialComponents.Toolbar.Surface`

ThemeOverlayåªå®šä¹‰æƒ³è¦æ”¹å˜çš„å±æ€§ï¼Œå…¶ä»–å±æ€§ä¸ä¼šè¢«æ”¹å˜ï¼Œ**æ³¨æ„parentç»å¸¸ä¼šè®¾ç½®ä¸º""**ã€‚çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œåªæœ‰`colorControlNormal`å’ŒactionMenuTextColorå±æ€§æ”¹å˜

![image-20201224104052296](https://gitee.com/cnting/cnting-blog-img/raw/master/img/image-20201224104052296.png)

ç³»ç»Ÿå®šä¹‰äº†å¾ˆå¤šå¸¸ç”¨çš„ThemeOverlayï¼Œå¯ä»¥çœ‹çœ‹[MDC](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/theme/res/values/themes_overlay.xml) å’Œ [AppCompat](https://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/appcompat/appcompat/src/main/res/values/themes.xml#76)

è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œ**å½“åœ¨viewä¸­ä½¿ç”¨Themeæ—¶ï¼Œåº”è¯¥ä½¿ç”¨ThemeOverlay**

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b430a9dde81f4372921e81ed2f9db63a~tplv-k3u1fbpfcp-zoom-1.image)

#### å†…å­˜å¼€é”€

æ¯å£°æ˜ä¸€ä¸ª`android:theme`,éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„`ContextThemeWrapper`æ¥åˆ†é…æ–°çš„Themeå’ŒResourceå®ä¾‹ï¼Œè¿˜é—´æ¥å¼•å…¥æ›´å¤šå±‚çš„stylingï¼Œæ‰€ä»¥è¦è°¨æ…ä½¿ç”¨themeï¼Œå°¤å…¶åœ¨RecyclerViewä¸‹



#### ä½¿ç”¨æ­£ç¡®çš„Context

Themeå¯ä»¥ä½œä¸ºContextçš„å±æ€§è¢«è·å–ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ä»ä»»ä½•Contextæˆ–è€…Contextçš„å­ç±»è·å¾—ï¼Œä¾‹å¦‚Activityã€Viewã€ViewGroupã€‚è¿™äº›å¯¹è±¡å­˜åœ¨äºä¸€ä¸ªæ ‘ä¸­ï¼Œåœ¨æ­¤æ ‘çš„ä»»ä½•çº§åˆ«ä¸ŠæŒ‡å®šä¸»é¢˜éƒ½ä¼šå½±å“åˆ°åä»£èŠ‚ç‚¹ã€‚

æŸ¥æ‰¾themeæ˜¯è·Ÿå½“å‰Contextç›¸å…³çš„ï¼Œæ‰€ä»¥è¦ä½¿ç”¨è·Ÿå½“å‰å±‚çº§æœ€æ¥è¿‘çš„Contextï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œ`Theme.App.Foo`å’Œ`Theme.App.Bar`ä¸­éƒ½å®šä¹‰äº†`foo`å±æ€§

```xml
<ViewGroup â€¦
  android:theme="@style/Theme.App.Foo">
  <Button â€¦
    android:theme="@style/Theme.App.Bar"/>
</ViewGroup>
```

å¦‚æœæˆ‘æƒ³åœ¨ä»£ç ä¸­æŸ¥æ‰¾`Button `çš„`foo`çš„å€¼ï¼Œéœ€è¦ä½¿ç”¨`button.getContext()`

```java
button.background = AppCompatResources.getDrawable(button.context,R.drawable.foo)
```

ä¸Šé¢è¯´åˆ°Themeå¯ä»¥ä½œä¸ºContextçš„å±æ€§è¢«è·å–ï¼Œä½†è¿™ä¸ªContextä¸åŒ…å«Applicationã€‚**Application Contextä¸åŒ…å«ä»»ä½•ä¸»é¢˜ä¿¡æ¯ï¼Œåœ¨manifestä¸­`<application>`æ ‡ç­¾ä¸­è®¾ç½®çš„ä¸»é¢˜ä»…ä½œç”¨äºé‚£äº›æ²¡æŒ‡å®šä¸»é¢˜çš„Activity**ã€‚å› æ­¤ä¸è¦ä½¿ç”¨Application ContextåŠ è½½themeä¸­çš„èµ„æºã€‚

è¿™ä¹Ÿè¯´æ˜äº†åœ¨ Activity å®šä¹‰çš„ theme ä¸ä¼šå— Application ä¸­çš„ Theme å½±å“



#### åœ¨ä»£ç ä¸­ä½¿ç”¨Theme Overlay

å¦‚æœæƒ³è¦åœ¨ä»£ç ä¸­ä½¿ç”¨Theme Overlayï¼Œå¯ä»¥å°†å…¶åŒ…è£¹æˆ`ContextThemeWrapper`ï¼Œè¿™ä¹Ÿæ˜¯`android:theme`æ ‡ç­¾å†…éƒ¨åšçš„äº‹æƒ…

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95f6cda77a05443eae87ba7e2b93f3e3~tplv-k3u1fbpfcp-zoom-1.image" alt="img" style="zoom:67%;" />



## ä¸€äº›å°æŠ€å·§

#### 1. è®¾ç½®é€æ˜åº¦

ä½¿ç”¨`ColorStateList`(ä¹Ÿå°±æ˜¯å¸¸è¯´çš„Selector)ï¼Œåªé…ç½®ä¸€ä¸ªitemï¼Œå¹¶è®¾ç½®é€æ˜åº¦

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c626bcd9fedf4ee9ae4b8aa09bc732f9~tplv-k3u1fbpfcp-zoom-1.image" alt="img" style="zoom:87%;" />



#### 2. ColorStateList å’Œ Drawableè½¬æ¢

ç»™viewè®¾ç½®backgroundç­‰å±æ€§æ—¶å¯ä»¥ç›´æ¥ä¼ å…¥colorï¼Œåœ¨å†…éƒ¨ç³»ç»Ÿä¼šå°†å®ƒåŒ…è£…æˆ`ColorDrawable`ã€‚ä½†å¦‚æœå°†`ColorStateList`ä¼ å…¥å°±ä¸è¡Œï¼Œåœ¨API 28ä¹‹å‰ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸º`ColorDrawable`æ˜¯æ— çŠ¶æ€çš„ï¼Œåœ¨Android 10ä¸­ï¼Œå®˜æ–¹åŠ å…¥äº†`ColorStateListDrawable`è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¸ºäº†æ‰€æœ‰APIéƒ½èƒ½ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`backgroundTint`æ–¹å¼è§£å†³

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8eb34265ef6438c847a147e6350dc8a~tplv-k3u1fbpfcp-zoom-1.image" alt="img" style="zoom:80%;" />



#### 3. æ‹†åˆ†å¤šä¸ªæ–‡ä»¶

* `theme.xml` : Theme å’Œ Theme Overlay
* `type.xml`ï¼š å­—ä½“ã€æ–‡æœ¬å¤–è§‚ã€æ–‡æœ¬å°ºå¯¸ã€å­—ä½“æ–‡ä»¶ç­‰
* `style.xml`ï¼šåªæœ‰widget style
* `shape.xml`ï¼šå½¢çŠ¶ç›¸å…³çš„style
* `dimens.xml`ã€`colors.xml`ã€`strings.xml`ã€`anim.xml`



#### 4. å‘½åè§„èŒƒ

```
[Style Type].[Group Name].[Sub-group Name].[Variant Name]
```

**(1) Style Type**

æè¿°è¿™ä¸ªstyleç±»å‹ï¼Œå¯ä»¥æ˜¯themeã€æ ·å¼ã€æ–‡æœ¬å¤–è§‚ã€Theme Overlayç­‰

| ç±»å‹          | å¸¸ç”¨åå­—        | ä¸¾ä¾‹                                                  |
| ------------- | --------------- | ----------------------------------------------------- |
| theme         | Theme           | **Theme**.AppCompat.DayNight.DarkActionBar            |
| Theme Overlay | ThemeOverlay    | **ThemeOverlay**.MaterialComponents.Toolbar.Surface   |
| æ§ä»¶ style    | Widget          | **Widget**.AppCompat.Toolbar                          |
| æ–‡æœ¬æ ·å¼      | TextAppearance  | **TextAppearance**.AppCompat.Body1                    |
| å½¢çŠ¶          | ShapeAppearance | **ShapeAppearance**.MaterialComponents.LargeComponent |
| åŠ¨ç”»          | Animation       | **Animation**.Design.BottomSheetDialog                |

**(2)  Group Name**

é€šå¸¸é‡‡ç”¨åº”ç”¨åç§°ï¼Œå¦‚æœæ˜¯å¤šmoduleä¹Ÿå¯ä»¥ç”¨moduleå

**(3)  Sub-group name**

é€šå¸¸ç”¨äºwidgetï¼Œä¾‹å¦‚ï¼šWidget.Design.**TabLayout**

**(4) Variant Name**

è¿™æ˜¯å¯é€‰çš„ï¼Œè¿™æ˜¯ä¸»é¢˜çš„å˜é‡ï¼Œä¾‹å¦‚ï¼š

* ThemeOverlay.MaterialComponents.Toolbar.**Primary**

* ThemeOverlay.MaterialComponents.Toolbar.**Surface**

  

#### 5. ColorPrimaryçš„ä½¿ç”¨

æœ‰äº›æ—¶å€™ï¼Œå¸Œæœ›æŸä¸ªé¢œè‰²æµ…è‰²æ¨¡å¼ä½¿ç”¨colorPrimaryï¼Œæ·±è‰²æ¨¡å¼ä½¿ç”¨colorSurfaceï¼Œå¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„`?attr/colorPrimarySurface`



#### 6. åœ¨ä»£ç ä¸­è·å–atträ¸­å®šä¹‰çš„é¢œè‰²

```kotlin
fun getColorFromAttr(
            context: Context,
            @AttrRes attrColor: Int,
            defaultValue: Int = R.color.app_green
): Int {
  return MaterialColors.getColor(context, attrColor, getColor(context, defaultValue))
}
```



## æ·±è‰²æ¨¡å¼é€‚é…

###### 1. ç»§æ‰¿DayNightä¸»é¢˜

```xml
<!--ä¸€äº›é»˜è®¤é…ç½®--> 
<style name="Base.Theme.ZM" parent="Theme.AppCompat.DayNight.NoActionBar">
    ...
 </style>
```

###### 2. å®šä¹‰æµ…è‰²å’Œæ·±è‰²ä¸¤ä¸ªtheme

å®šä¹‰æµ…è‰²çš„theme

```xml
<!--ä½äº values/theme.xml -->
<style name="Theme.ZM" parent="Base.Theme.ZM">
   <item name="colorPrimary">@color/app_green</item>
   <item name="colorPrimaryVariant">@color/color_00b77f</item>
   <item name="colorPrimarySurface">@color/app_green</item>
   <item name="colorSecondary">@color/app_orange</item>
   <item name="colorSecondaryVariant">@color/color_FB8D00</item>
   ...
</style>
```

å®šä¹‰æ·±è‰²çš„theme

```xml
<!--ä½äº values-night/theme.xml -->
<style name="Theme.ZM" parent="Base.Theme.ZM">
  <item name="colorPrimary">@color/app_green_night</item>
  <item name="colorPrimaryVariant">@color/color_287859</item>
  <item name="colorPrimarySurface">@color/color_323943</item>
  <item name="colorSecondary">@color/app_orange_night</item>
  <item name="colorSecondaryVariant">@color/color_86591D</item>
  ...
</style>
```

###### 3. ä½¿ç”¨èµ„æº

åœ¨å¸ƒå±€ä¸­å°½é‡ä¸è¦ç›´æ¥è°ƒç”¨`@color/XXX` æˆ–è€… ç¡¬ç¼–ç  èµ„æºï¼Œä¸ç„¶åç»­è°ƒæ•´æ—¶ä¼šç–¯æ‰ï¼Œæ­£ç¡®å§¿åŠ¿æ˜¯ä½¿ç”¨`?attr/XXX`

###### 4. åœ¨BaseActivityä¸­è®¾ç½®theme

```java
public class BaseActivity extends AppCompatActivity{
    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        supportRequestWindowFeature(Window.FEATURE_NO_TITLE)
        super.onCreate(savedInstanceState)
        //åœ¨setContentView()å‰è®¾ç½®Theme
        setTheme(R.style.Theme_ZM)
        super.setContentView(R.layout.activity_base_layout)
    }
}
```

###### 5. å‘Šè¯‰ç³»ç»Ÿå½“å‰ä½¿ç”¨çš„ä¸»é¢˜

```java
AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO)
```

æ–¹æ³•é‡Œçš„å‚æ•°ä¸»è¦æœ‰ä»¥ä¸‹å¯é€‰å€¼ï¼š

* `MODE_NIGHT_FOLLOW_SYSTEM`ï¼šè·Ÿéšç³»ç»Ÿ
* `MODE_NIGHT_YES`: æ·±è‰²æ¨¡å¼
* `MODE_NIGHT_NO`: æµ…è‰²æ¨¡å¼
* `MODE_NIGHT_AUTO_BATTERY`: æ ¹æ®æ‰‹æœºç”µé‡å†³å®šä½¿ç”¨æµ…è‰²è¿˜æ˜¯æ·±è‰²æ¨¡å¼

###### 6. å¦‚æœéœ€è¦ç›‘å¬ç³»ç»Ÿæ·±è‰²æ¨¡å¼åˆ‡æ¢

ï¼ˆ1ï¼‰åœ¨ `AndroidManifest.xml` ä¸­ç»™ `<Application>` æ·»åŠ  `android:configChanges="uiMode"`

```xml
 <application
      android:name="MyApp"
      android:allowBackup="false"
      android:icon="@mipmap/ic_launcher"
      android:label="@string/app_name"
      android:configChanges="uiMode"
     >
```

ï¼ˆ2ï¼‰åœ¨ `MyApp`ä¸­å¤å†™`onConfigurationChanged()`æ–¹æ³•

```java
@Override
public void onConfigurationChanged(@NonNull Configuration newConfig) {
  super.onConfigurationChanged(newConfig);
  //è¿™é‡Œå¯ç›‘å¬åˆ°ç³»ç»Ÿæ·±è‰²æ¨¡å¼åˆ‡æ¢
}
```

###### 7. åˆ‡æ¢åŠ¨ç”»

è¿™é‡Œåˆ—å‡ºæ‰¾åˆ°çš„ä¸€äº›èµ„æºï¼š

* [å‚è€ƒTelegramåˆ‡æ¢åŠ¨ç”»](https://proandroiddev.com/change-theme-dynamically-with-circular-reveal-animation-on-android-8cd574f5f0d8)
* [å‚è€ƒçŸ¥ä¹åˆ‡æ¢åŠ¨ç”»](https://www.jianshu.com/p/3b55e84742e5)
* åœ¨ åˆ‡æ¢æ·±è‰²æ¨¡å¼æ—¶ è®¾ç½®åŠ¨ç”» `activity.window.setWindowAnimations(R.style.Animation_ZM_Activity_Fade)`

###### 8. å›¾ç‰‡åŒºåˆ†æµ…è‰²æ¨¡å¼å’Œæ·±è‰²æ¨¡å¼

å°†å›¾ç‰‡åˆ†åˆ«æ”¾ç½®åœ¨`drawable/xxx`å’Œ`drawable-night-xxx`æ–‡ä»¶å¤¹ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¦‚ä¸‹

```xml
<ImageView android:src="@drawable/test" />
```



## å®ä¾‹1

ä¸€ç›´ä»¥æ¥ï¼Œä½¿ç”¨colorã€themeéƒ½æ˜¯æŒ‰ç…§ä¸‹é¢æ–¹å¼

åœ¨`res/values/colors.xml` å’Œ `res/values-night/colors.xml` ä¸­å®šä¹‰`color_primary`ï¼Œç„¶ååœ¨layoutä¸­ä½¿ç”¨`@color/color_primary`ã€‚

è¿™æ ·æœ‰å‡ ä¸ªä¸å¥½çš„ç‚¹ï¼š

1. coloré‡Œçš„å‘½åæ—¢ä»£è¡¨äº†è¯­ä¹‰åˆä»£è¡¨äº†è‰²å€¼ï¼Œä¼šå¯¼è‡´ä¸€äº›è‰²å€¼é‡å¤å®šä¹‰
2. æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰çš„é¢œè‰²ä¸æƒ³è·Ÿç€æ—¥å¤œé—´æ¨¡å¼åˆ‡æ¢è€Œæ”¹å˜ï¼Œå°±éœ€è¦å†é‡å¤å®šä¹‰ä¸€äº›ç›¸åŒçš„é¢œè‰²äº†



æ­£ç¡®åšæ³•åº”è¯¥æ˜¯è¿™æ ·ï¼š

1. åœ¨colorä¸­ç”¨é¢œè‰²å€¼å‘½å

   ```xml
   //values/colors.xml
   <color name="indigo_500">...</color>
   <color name="indigo_200">...</color>
   ```

   

2. åœ¨themeæŠ½å–å…¬å…±éƒ¨åˆ†åˆ°`Base.Theme.MyApp`ï¼Œç„¶åå†æ ¹æ®æ—¥å¤œé—´æ¨¡å¼å®šä¹‰ä¸¤ä¸ªthemeä¸­å®šä¹‰

   ```xml
   //values/themes.xml
   <style name="Theme.MyApp" parent="Base.Theme.MyApp">
     <item name="colorPrimary">@color/indigo_500</item>
   </style>
   
   //values-night/themes.xml
   <style name="Theme.MyApp" parent="Base.Theme.MyApp">
     <item name="colorPrimary">@color/indigo_200</item>
   </style>
   ```

   

3. åœ¨layoutä¸­å¼•ç”¨`android:background="?attr/colorPrimary"`



## å®ä¾‹2

åœ¨é¡¹ç›®ä¸­ï¼Œ`Toolbar`æ˜¯å®šä¹‰åœ¨`BaseActivity`ä¸­çš„ï¼Œè€Œé¡¹ç›®ä¸­æ–°è€é¡µé¢çš„æ ‡é¢˜æ é¢œè‰²æ˜¯ä¸åŒçš„ï¼Œåˆ†ä¸ºç»¿è‰²å’Œç™½è‰²

```xml
 <!--æ ‡é¢˜æ èƒŒæ™¯è‰²æ˜¯ç™½è‰²ï¼Œæ–‡å­—å’Œå›¾æ ‡æ˜¯é»‘è‰²-->
<style name="ThemeOverlay.ZM.Toolbar.Surface" parent="">
  <item name="android:background">?attr/colorSurface</item>
  <item name="actionMenuTextColor">?attr/color_text_999</item>
  <item name="titleTextColor">?attr/colorOnSurface</item>
</style>

<!--æ ‡é¢˜æ èƒŒæ™¯è‰²æ˜¯ç»¿è‰²ï¼Œæ–‡å­—å’Œå›¾æ ‡æ˜¯ç™½è‰²-->
<style name="ThemeOverlay.ZM.Toolbar.Primary" parent="">
  <item name="android:background">?attr/colorPrimarySurface</item>
  <item name="actionMenuTextColor">?attr/colorOnPrimary</item>
  <item name="titleTextColor">?attr/colorOnPrimary</item>
</style>
```

åœ¨å¸ƒå±€ä¸­å¯ä»¥ç›´æ¥å®šä¹‰ä½¿ç”¨æŸä¸€ä¸ªæ ·å¼ï¼Œæ¯”å¦‚ç™½è‰²æ ‡é¢˜æ 

```xml 
  <androidx.appcompat.widget.Toolbar
        android:id="@+id/baseToolbar"
        android:layout_width="0dp"
        android:layout_height="?attr/actionBarSize"
        android:theme="@style/ThemeOverlay.ZM.Toolbar.Surface"
        app:contentInsetLeft="0dp"
        app:contentInsetStart="0dp"
        app:contentInsetStartWithNavigation="0dp"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"
        app:layout_constraintTop_toTopOf="parent"
        app:popupTheme="@style/Widget.ZM.PopupMenu.Overflow">
```

ä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­åŠ¨æ€è®¾ç½®

```kotlin
when {
  getToolbarType() == ToolbarType.PRIAMRY -> {
    getToolbar().context.setTheme(R.style.ThemeOverlay_ZM_Toolbar_Primary)
  }
  getToolbarType() == ToolbarType.FLOATING -> {
    getToolbar().context.setTheme(R.style.ThemeOverlay_ZM_Toolbar_Transparent)
  }
  getToolbarType() == ToolbarType.NONE -> {
    setToolBarVisibily(false)
  }
}
```

è¿™æ—¶å€™éœ€è¦æ³¨æ„ï¼Œå¦‚æœæƒ³åœ¨ä»£ç ä¸­è·å–Toolbarçš„èƒŒæ™¯è‰²ä¹‹ç±»çš„èµ„æºï¼Œéœ€è¦ç¡®ä¿ä¼ å…¥çš„æ˜¯`Toolbar`çš„`context`

```kotlin
fun getToolbarTitleColor() = ResourceUtil.getColorFromAttr(getToolbar().context, R.attr.titleTextColor)
fun getToolbarBgColor() = ResourceUtil.getColorFromAttr(getToolbar().context, android.R.attr.background)
fun getToolbarIconColor() = ResourceUtil.getColorFromAttr(getToolbar().context, R.attr.actionMenuTextColor)
```



## å¸¸è§é—®é¢˜

#### 1. ActionBarå’ŒToolBaråŒºåˆ«

ActionBaræ˜¯3.0æ¨å‡ºçš„ï¼ŒToolBaræ˜¯5.0æ¨å‡ºçš„ï¼Œç›®çš„æ˜¯ä¸ºäº†å–ä»£ActionBarã€‚å–ä»£æ–¹å¼å¦‚ä¸‹ï¼š

1. åœ¨ä¸»é¢˜themeé‡Œç»§æ‰¿åç¼€ä¸º`.NoActionBar` çš„ä¸»é¢˜ï¼Œæˆ–è€…åœ¨ä¸»é¢˜ä¸­åŠ å…¥ï¼š

   ```xml
   <item name="windowActionBar">false</item>
   <item name="windowNoTitle">true</item>
   ```

2. åœ¨ä»£ç ä¸­è®¾ç½® `setSupportActionBar(toobar)`

   

#### 2.ä½ç‰ˆæœ¬ä½¿ç”¨alpha

alphaç»„ä»¶æ˜¯åœ¨API23åå¼•å…¥ï¼Œæ‰€ä»¥å¦‚æœmin sdkæ¯”è¿™ä¸ªä½ï¼Œè¦ä½¿ç”¨å…¼å®¹çš„[AppCompatResources.getColorStateList](https://developer.android.com/reference/androidx/appcompat/content/res/AppCompatResources.html#public-methods_1) å¹¶ä¸€ç›´ä½¿ç”¨ `android:alpha` å‘½åç©ºé—´ï¼Œä¸è¦ä½¿ç”¨ `app:alpha` å‘½åç©ºé—´

#### 3. æ£€æµ‹å·¥å…·

[Making Android Lint Theme Aware â€” Part 1](https://proandroiddev.com/making-android-lint-theme-aware-6285737b13bc)



#### 4. è®¾ç½®å…¨å±

```java
setSystemUiVisibility( View.SYSTEM_UI_FLAG_IMMERSIVE
        // Set the content to appear under the system bars so that the
        // content doesn't resize when the system bars hide and show.
        | View.SYSTEM_UI_FLAG_LAYOUT_STABLE
        | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
        | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN
        // Hide the nav bar and status bar
        | View.SYSTEM_UI_FLAG_HIDE_NAVIGATION
        | View.SYSTEM_UI_FLAG_FULLSCREEN
);
```



## å‚è€ƒï¼š

* [Android 10é€‚é…è¦ç‚¹ï¼Œæ·±è‰²ä¸»é¢˜](https://blog.csdn.net/guolin_blog/article/details/106061657)
* [Flywith24 çš„ Android Stylingç³»åˆ—æ–‡ç« ](https://juejin.cn/post/6844903974047318030)