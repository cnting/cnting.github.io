---
layout:     post
title:      "ä½¿ç”¨Themeçš„æ­£ç¡®æ–¹å¼"
subtitle:   " è®°å½• èµ„æºæ•´ç† ä»¥åŠ å¤œé—´æ¨¡å¼é€‚é… çš„è¿‡ç¨‹"
date:       2020-12-23 17:24:00
author:     "cnting"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - Android
    - Theme
---



å‰é¢ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯æ‘˜å½•è‡ª[Flywith24 çš„ Android Stylingç³»åˆ—æ–‡ç« ](https://juejin.cn/post/6844903974047318030)ï¼ˆä¸»è¦ä¸ºäº†æ•´ç†å’Œç†è§£æ–¹ä¾¿ğŸ˜‚ï¼‰ï¼Œå¼ºçƒˆå»ºè®®å¤§å®¶çœ‹åŸæ–‡

## Theme å’Œ Styleçš„åŒºåˆ«

### Styleæ˜¯ä»€ä¹ˆï¼Ÿ

Styleæ˜¯**viewçš„å±æ€§çš„é›†åˆ** ï¼Œä½ å¯ä»¥å°†styleè§†ä¸º`Map<view attribute,resource>`ã€‚è¿™é‡Œçš„keyæ˜¯viewçš„æ‰€æœ‰å±æ€§ï¼Œéƒ½æ˜¯å¯ä»¥åœ¨layoutæ–‡ä»¶ä¸­é…ç½®çš„

ä¸€ä¸ªstyleåªèƒ½ä½œç”¨äºå…¶åº”ç”¨çš„viewï¼Œä¸åŒ…å«å®ƒçš„å­viewã€‚

### Themeæ˜¯ä»€ä¹ˆï¼Ÿ

Themeæ˜¯èµ„æºçš„é›†åˆï¼Œå®ƒå¯ä»¥è¢«styleã€layoutæˆ–è€…å…¶ä»–å¼•ç”¨ã€‚å®ƒä¸ºandroidèµ„æºæä¾›è¯­ä¹‰æ˜ç¡®çš„å‘½åï¼Œå¦‚ä¸‹ï¼š

```xml
<!-- Copyright 2019 Google LLC.	
   SPDX-License-Identifier: Apache-2.0 -->
<style name="Theme.Plaid" parent="â€¦">
  <item name="colorPrimary">@color/teal_500</item>
  <item name="colorSecondary">@color/pink_200</item>
  <item name="android:windowBackground">@color/white</item>
</style>
```

Themeä¸ºè¿™äº›å·²å‘½åçš„èµ„æºæä¾›æ­£ç¡®çš„å€¼ï¼Œå¹¿æ³›åº”ç”¨åœ¨æ•´ä¸ªç¨‹åºä¸­ã€‚çœ‹ä¸‹é¢çš„ä¼ªä»£ç ï¼š

```java
/* Copyright 2019 Google LLC.	
   SPDX-License-Identifier: Apache-2.0 */
interface ColorPalette {
  @ColorInt val colorPrimary
  @ColorInt val colorSecondary
}

class MyView(colors: ColorPalette) {
  fab.backgroundTint = colors.colorPrimary
}

/* Copyright 2019 Google LLC.	
   SPDX-License-Identifier: Apache-2.0 */
val lightPalette = object : ColorPalette { â€¦ }
val darkPalette = object : ColorPalette { â€¦ }
//æ ¹æ®æ—¥å¤œé—´æ¨¡å¼åˆ‡æ¢ä¸åŒçš„themeï¼Œè€Œä¸ç”¨æ›´æ”¹viewçš„é€»è¾‘
val view = MyView(if (isDarkTheme) darkPalette else lightPalette)
```

Themeå¯ä»¥åœ¨`application`ã€`Activity`ã€`View`ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`ContextThemeWrapper`åŒ…è£…ç°æœ‰çš„Contextæ¥åœ¨ä»£ç ä¸­è®¾ç½®themeï¼Œç„¶åå°†å…¶ç”¨äºinflateå¸ƒå±€

TODOï¼šéœ€è¦æ·»åŠ ä¾‹å­

Themeå¯ä»¥ä½œä¸ºContextçš„å±æ€§è¢«è·å–ï¼Œå¹¶ä¸”Themeå¯ä»¥è¢«ç»§æ‰¿ã€‚



## å¸¸ç”¨ä¸»é¢˜å±æ€§

å¸¸ç”¨çš„ä¸»é¢˜å±æ€§å¯ä»¥çœ‹è¿™é‡Œï¼š[Color Theming](https://material.io/develop/android/theming/color)

### Colors

* `?attr/colorPrimary` app ä¸»è‰²

* `?attr/colorSecondary` app æ¬¡çº§é¢œè‰²ï¼Œé€šå¸¸ä½œä¸ºä¸»è‰²çš„è¡¥å……

* `?attr/colorOn[Primary, Secondary, Surface etc]` ä¸å‘½åé¢œè‰²å½¢æˆå¯¹æ¯”çš„é¢œè‰²

* `?attr/color[Primary, Secondary]Variant` ç»™å®šé¢œè‰²çš„é˜´å½±

* `?attr/colorSurface` ç»„ä»¶ç•Œé¢ï¼ˆå¡ç‰‡ï¼Œè¡¨æ ¼ï¼Œèœå•ç­‰ï¼‰çš„é¢œè‰²

* `?android:attr/colorBackground` èƒŒæ™¯

* `?attr/colorPrimarySurface` åœ¨æµ…è‰²ä¸»é¢˜çš„  `colorPrimary` å’Œæ·±è‰²ä¸»é¢˜çš„ `colorSurface` é—´åˆ‡æ¢

* `?attr/colorError` é”™è¯¯æ¶ˆæ¯çš„é¢œè‰²

* `?attr/colorControlNormal` æ­£å¸¸çŠ¶æ€ä¸‹å›¾æ ‡/æ§ä»¶çš„é¢œè‰²

* `?attr/colorControlActivated` æ¿€æ´»çŠ¶æ€ä¸‹å›¾æ ‡/æ§ä»¶çš„é¢œè‰²ï¼ˆä¾‹å¦‚ checkedï¼‰

* `?attr/colorControlHighlight` é«˜äº®é¢œè‰²ï¼ˆä¾‹å¦‚ ripplesï¼Œ list selectorsï¼‰

* `?android:attr/textColorPrimary` text çªå‡ºé¢œè‰²

* `?android:attr/textColorSecondary` text æ¬¡è¦é¢œè‰²

### Dimens

- `?attr/listPreferredItemHeight` list item çš„æ ‡å‡†ï¼ˆæœ€å°ï¼‰é«˜åº¦
- `?attr/actionBarSize` toolbar çš„é«˜åº¦

### Drawables

* `?attr/selectableItemBackground` å½“å‰äº¤äº’é¡¹çš„æ°´æ³¢çº¹/é«˜äº®ï¼ˆä¹Ÿä¸ºå‰æ™¯æä¾›äº†ä¾¿åˆ©ï¼‰

* `?attr/selectableItemBackgroundBorderless` æ— ç•Œçš„æ°´æ³¢çº¹

* `?attr/dividerVertical` ä¸€ä¸ªå¯ç»˜åˆ¶å¯¹è±¡ï¼Œå¯ç”¨ä½œå…ƒç´ ä¹‹é—´çš„å‚ç›´åˆ†éš”çº¿

* `?attr/dividerHorizontal` ä¸€ä¸ªå¯ç»˜åˆ¶å¯¹è±¡ï¼Œå¯ç”¨ä½œå…ƒç´ ä¹‹é—´çš„æ°´å¹³åˆ†éš”çº¿

### TextAppearances

æ”¾åœ¨`type.xml`æ–‡ä»¶ä¸­ï¼Œå®šä¹‰[å¸¸ç”¨å­—ä½“å¤§å°](https://material.io/design/typography/the-type-system.html#type-scale)ï¼Œåœ¨TextViewä¸­å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¼•ç”¨

`````
android:textAppearance="?attr/textAppearanceBody1"
`````

* `?attr/textAppearanceHeadline1`  é»˜è®¤çš„æµ…è‰² 96sp æ–‡æœ¬

* `?attr/textAppearanceHeadline2`  é»˜è®¤çš„æµ…è‰² 60sp æ–‡æœ¬

* `?attr/textAppearanceHeadline3`  é»˜è®¤çš„æ™®é€š 48sp æ–‡æœ¬

* `?attr/textAppearanceHeadline4`  é»˜è®¤çš„æ™®é€š 34sp æ–‡æœ¬

* `?attr/textAppearanceHeadline5`  é»˜è®¤çš„æ™®é€š 24sp æ–‡æœ¬

* `?attr/textAppearanceHeadline6`  é»˜è®¤çš„ä¸­ç­‰ 20sp æ–‡æœ¬

* `?attr/textAppearanceSubtitle1`  é»˜è®¤çš„æ™®é€š 16sp æ–‡æœ¬

* `?attr/textAppearanceSubtitle2`  é»˜è®¤çš„ä¸­ç­‰ 14sp æ–‡æœ¬

* `?attr/textAppearanceBody1`  é»˜è®¤çš„æ™®é€š 16sp æ–‡æœ¬

* `?attr/textAppearanceBody2`  é»˜è®¤çš„æ™®é€š 14sp æ–‡æœ¬

* `?attr/textAppearanceCaption`  é»˜è®¤æ™®é€š 12sp æ–‡æœ¬

* `?attr/textAppearanceButton`  é»˜è®¤çš„ä¸­ç­‰å…¨å¤§å†™ 14sp æ–‡æœ¬

* `?attr/textAppearanceOverline`  é»˜è®¤çš„ä¸­ç­‰å…¨å¤§å†™ 10sp æ–‡æœ¬

### Shape

æ”¾åœ¨`shape.xml`æ–‡ä»¶ä¸­ï¼Œå®šä¹‰ä¸€äº›å¸¸ç”¨å½¢çŠ¶çš„åœ†è§’ç­‰å±æ€§ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å¯ä»¥çœ‹è¿™é‡Œï¼š[Shape Theming](https://material.io/develop/android/theming/shape)ã€‚è¦åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸Šè®¾ç½®shapeï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨`MaterialShapeDrawable`ï¼Œå®ƒå¯ä»¥ç†è§£å¹¶å®ç°shape

* `?attr/shapeAppearanceSmallComponent` åœ¨ Button ï¼ŒChipï¼ŒText çš„å±æ€§ä¸­ä½¿ç”¨ï¼Œé»˜è®¤ 4dp çš„åœ†è§’

* `?attr/shapeAppearanceMediumComponent` åœ¨ Cardï¼ŒDialogï¼ŒDate Picker ä¸­ä½¿ç”¨ï¼Œé»˜è®¤ 4dp çš„åœ†è§’

* `?attr/shapeAppearanceLargeComponent` åœ¨ Bottom Sheet ä¸­ä½¿ç”¨ï¼Œé»˜è®¤ 0dp åœ†è§’

### Button Styles

<img src="https://lh3.googleusercontent.com/paigCrPwj4o5nOy781U_k0QfrtmDz9dcQEdBzUUqitMEfzXhy4XWKwQPEFiM0qbpZidJxv3VE3FlFK-GkcHVLRXm8ew0GBn9HjRw8Ec=w1064-v0" alt="&quot;Button types - text, outlined, contained and toggle.&quot;" style="zoom:50%;" />

Material å®šä¹‰äº†å››ç§ç±»å‹çš„Buttonï¼šTextã€Outlinedã€Containedã€Toggleï¼Œå¯ç”¨äºè®¾ç½®`MaterialButton`çš„ styleï¼Œå…·ä½“ä½¿ç”¨çœ‹è¿™é‡Œï¼š[Buttons](https://material.io/components/buttons/android)

* `?attr/materialButtonStyle` é»˜è®¤æ ·å¼ï¼Œå¯çœç•¥

* `?attr/borderlessButtonStyle` æ–‡æœ¬æ ·å¼çš„ button

* `?attr/materialButtonOutlinedStyle` outline æ ·å¼çš„ button

* `?attr/materialButtonToggleGroupStyle` Toggleæ ·å¼çš„buttonã€‚Toggleç±»å‹æŒ‰é’®ä½¿ç”¨`MaterialButtonToggleGroup`ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

  ```xml
  <com.google.android.material.button.MaterialButtonToggleGroup
      android:id="@+id/toggleButton"
      android:layout_width="wrap_content"
      android:layout_height="wrap_content">
      <Button
          android:id="@+id/button1"
          android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="Button 1"
          style="?attr/materialButtonOutlinedStyle"
      />
      <Button
          android:id="@+id/button2"
          android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="Button 2"
          style="?attr/materialButtonOutlinedStyle"
      />
      <Button
          android:id="@+id/button3"
          android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="Button 3"
          style="?attr/materialButtonOutlinedStyle"
      />
  </com.google.android.material.button.MaterialButtonToggleGroup>
  ```

### App vs Android namespace

ä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œæœ‰äº›å±æ€§ç”± `?android:attr/foo` å¼•ç”¨ï¼Œè€Œå…¶ä»–çš„åˆ™ä¸º `?attr/bar` ã€‚è¿™æ˜¯å› ä¸ºå®ƒä»¬ä¸­çš„éƒ¨åˆ†æ˜¯ç”± Android Platform å®šä¹‰çš„ï¼Œå› æ­¤æ‚¨éœ€è¦ `android`å‰ç¼€é€šè¿‡å‘½åç©ºé—´å¼•ç”¨å®ƒä»¬ï¼ˆå°±åƒ layout ä¸­ view çš„å±æ€§ï¼š`android:id`ï¼‰ã€‚é‚£äº›ä¸æ˜¯æ¥è‡ªé™æ€åº“ï¼ˆå³ AppCompat æˆ– MDC ï¼‰ï¼Œå®ƒä»¬å·²ç¼–è¯‘åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå› æ­¤ä¸éœ€è¦åç§°ç©ºé—´ï¼ˆç±»ä¼¼äºæ‚¨åœ¨å¸ƒå±€ä¸­ä½¿ç”¨ `appï¼šbaz` çš„æ–¹å¼ï¼‰ã€‚ä¸€äº›å…ƒç´ åœ¨ platform å’Œ library å‡æœ‰å®šä¹‰ï¼ˆä¾‹å¦‚ `colorPrimary`ï¼‰ã€‚**åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½ä½¿ç”¨éå¹³å°ç‰ˆæœ¬ï¼Œè¿™æ ·å¯ä»¥åœ¨æ‰€æœ‰ API çº§åˆ«ä¸Šä½¿ç”¨**ã€‚ä¾‹å¦‚å®ƒä»¬æ˜¯åœ¨ library ä¸­é‡å¤å®šä¹‰æ°å¥½ç›®çš„æ˜¯ä¸ºäº†å‘åå…¼å®¹

å¯ç”¨å±æ€§çš„å®Œæ•´åˆ—è¡¨ï¼š

* [Android platform](https://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/core/res/res/values/attrs.xml)
* [AppCompat](https://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/appcompat/appcompat/src/main/res/values/attrs.xml)
* [Material Color](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/color/res/values/attrs.xml)
* [Material Shape](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/shape/res/values/attrs.xml)
* [Material Type](https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/typography/res/values/attrs.xml)



## Theme overlays



## å®ä¾‹1

ä¸€ç›´ä»¥æ¥ï¼Œä½¿ç”¨colorã€themeéƒ½æ˜¯æŒ‰ç…§ä¸‹é¢æ–¹å¼

åœ¨`res/values/colors.xml` å’Œ `res/values-night/colors.xml` ä¸­å®šä¹‰`color_primary`ï¼Œç„¶ååœ¨layoutä¸­ä½¿ç”¨`@color/color_primary`ã€‚

è¿™æ ·æœ‰å‡ ä¸ªä¸å¥½çš„ç‚¹ï¼š

1. coloré‡Œçš„å‘½åæ—¢ä»£è¡¨äº†è¯­ä¹‰åˆä»£è¡¨äº†è‰²å€¼ï¼Œä¼šå¯¼è‡´ä¸€äº›è‰²å€¼é‡å¤å®šä¹‰
2. æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰çš„é¢œè‰²ä¸æƒ³è·Ÿç€æ—¥å¤œé—´æ¨¡å¼åˆ‡æ¢è€Œæ”¹å˜ï¼Œå°±éœ€è¦å†é‡å¤å®šä¹‰ä¸€äº›ç›¸åŒçš„é¢œè‰²äº†



æ­£ç¡®åšæ³•åº”è¯¥æ˜¯è¿™æ ·ï¼š

1. åœ¨colorä¸­ç”¨é¢œè‰²å€¼å‘½åï¼Œæ¯”å¦‚`brand_green`ã€`brand_orange`ã€‚ï¼ˆè¿™æ ·åº”è¯¥åªéœ€è¦ä¸€ä¸ªcolors.xmläº†å§ï¼Ÿï¼‰
2. åœ¨themeä¸­å®šä¹‰`<item name="colorPrimary">@color/brand_green</item>`
3. åœ¨layoutä¸­å¼•ç”¨`android:background="?attr/colorPrimary"`





## å¸¸è§é—®é¢˜

### 1. ActionBarå’ŒToolBaråŒºåˆ«

ActionBaræ˜¯3.0æ¨å‡ºçš„ï¼ŒToolBaræ˜¯5.0æ¨å‡ºçš„ï¼Œç›®çš„æ˜¯ä¸ºäº†å–ä»£ActionBarã€‚å–ä»£æ–¹å¼å¦‚ä¸‹ï¼š

1. åœ¨ä¸»é¢˜themeé‡Œç»§æ‰¿åç¼€ä¸º`.NoActionBar` çš„ä¸»é¢˜
2. åœ¨ä»£ç ä¸­è®¾ç½® `setSupportActionBar(toobar)`



### 2.ä½ç‰ˆæœ¬ä½¿ç”¨alpha

alphaç»„ä»¶æ˜¯åœ¨API23åå¼•å…¥ï¼Œæ‰€ä»¥å¦‚æœmin sdkæ¯”è¿™ä¸ªä½ï¼Œè¦ä½¿ç”¨å…¼å®¹çš„[AppCompatResources.getColorStateList](https://developer.android.com/reference/androidx/appcompat/content/res/AppCompatResources.html#public-methods_1) å¹¶ä¸€ç›´ä½¿ç”¨ `android:alpha` å‘½åç©ºé—´ï¼Œä¸è¦ä½¿ç”¨ `app:alpha` å‘½åç©ºé—´

### 3. æ£€æµ‹å·¥å…·

[Making Android Lint Theme Aware â€” Part 1](https://proandroiddev.com/making-android-lint-theme-aware-6285737b13bc)

